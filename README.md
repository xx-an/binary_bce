# WinCheck: A Concolic Model Checker for Pointer-Related Properties on Windows Binaries

# Introduction
WinCheck is a model checker that automatically detects pointer-related security properties on Windows executables. The validated properties include buffer overflow, user-after-free, and null-pointer dereference.

# Setup
WinCheck structure:

    benchmark/
    bin/
    src/
    LICENSE
    README.md
    ext_env.config
    ida_struct.info

Prerequisites:

    java (>=19.0.2)
    GNU objdump (GNU Binutils for Ubuntu) 2.38
    IDA Pro (>= 7.6, not necessary, could be used for testing)
    Z3Prover (>=4.12.0)
    apache.commons.cli (>=1.5.0)
    
Environment setup:

    Download pre-built z3 binaries from [here](https://github.com/Z3Prover/z3/releases) according to the operating system and ISA.
    Download Apache commons cli from [here](https://commons.apache.org/proper/commons-cli/download_cli.cgi).
    Add /path/to/commons-cli-1.5.0.jar and /path/to/com.microsoft.z3.jar to CLASSPATH environment variable.
    Add /path/to/z3/ to LD\_LIBRARY\_PATH environment variable.
    
    
# IDA Pro results

To ensure WinCheck could be applied on the outputs generated by IDA Pro disassembler, we used an *ida_struct.info* file to keep record of all the struct type information defined by IDA Pro disassembler. Currently, the recorded struct type is sufficient for the testing on our benchmark. If you need to test IDA Pro on some other test cases and some of the IDA-defined struct type is unrecognizable, you could add the corresponding information in the *ida_struct.info* file. The *offset* indicates the offset of corresponding item in the struct.

    struct name: 
      item_name: offset, item_type (? represents undefined or unknown type)

# Note

    -- The binary files for Coreutils are located at benchmark/coreutils-bin
    -- The closed-source Windows executables are under the directory benchmark/pe_benchmark
    -- The overall result is stored in a .output file, and the logging information is in a .log file

# Running test cases

Compile the WinCheck project:

    $ cd /path/to/wincheck
    $ find -name "*.java" > sources.txt
    $ javac -d bin/ @sources.txt

Apply WinCheck to detect pointer-related properties for a binary file in the Coreutils library

    $ cd bin
    $ java WinCheck -e benchmark/coreutils-bin -l benchmark/coreutils-idapro -f basename.exe

Use WinCheck to detect pointer-related properties for the whole Coreutils library

    $ cd bin
    $ java WinCheck -e benchmark/coreutils-bin -l benchmark/coreutils-idapro -m 32 -b

Use WinCheck to detect pointer-related properties for a closed-source Windows executable

    $ cd bin
    $ java WinCheck -l benchmark/pe_benchmark -e benchmark/pe_benchmark -m 32 -f HOSTNAME.EXE



